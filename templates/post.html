<div class="post">
    <div class="post-heading">
        <div class="post-title">
            {{ p.subject }}
        </div>
        <div class="post-date">
            {{ p.created.strftime("%b %d, %Y") }}
        </div>
    </div>
    <div class="post-content">
        {{ p._render_text | safe }}
    </div>
</div>
<!-- Only logged in users will see these buttons -->
{% if user_id %}
<!-- If the current user is the author of a post, then show the edit/delete button -->
{% if p.author.id() == user_id %}
<form method="post">
    <input type="hidden" name="post_id" value="{{ p.key.urlsafe() }}">
    <input type="submit" name="action" value="edit/delete">
</form>
{% else %}
<!-- Only display like button if user is not the author of a post -->
<div>
    <a href="#" class="like" data-key="{{ p.key.id() }}">
        <span>{{p.likes}}</span> Likes
    </a>
</div>
{% endif %}
{% endif %}
<script>
$('.like').on('click', function(e) {
    e.preventDefault();
    var instance = $(this);
    var key = $(this).data('key');

    $.ajax({
        type: "post",
        url: "/like", // Route which will handle the request
        dataType: 'json',
        data: {
            "post_key": key
        },
        success: function(data) {
            instance.find('span').html(data.likes);
        }
    });
});
</script>
